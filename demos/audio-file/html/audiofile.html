<!DOCTYPE html>
<html>
    <head>
        <title>Audio File Decoding Demo</title>
        
        <link rel="stylesheet" type="text/css" href="../css/audiofile.css" />
        
        <script src="../../../flocking/flocking-core.js"></script>
        <script src="../../../flocking/flocking-parser.js"></script>
        <script src="../../../flocking/flocking-ugens.js"></script>
        <script src="../../../flocking/flocking-audiofile.js"></script>
        <script src="../../../flocking/flocking-gfx.js"></script>
        
        <script src="../../shared/js/demo-utils.js"></script>
    </head>
    
    <body>
        <h1>Audio File Decoding Demo</h1>
        
        <div class="controls">
            <form class="fileSelector">
                <label for="fileBrowser">Choose a sound file</label>
                <input id="fileBrowser" type="file" />
                <div id="filePath"></div>
                <button id="browse">Choose a sound file...</button>
            </form>
        
            <button id="playButton">Play</button>
        </div>
        <div class="view">
            <canvas id="waveform" height="200" width="960"></canvas>
        </div>
        
        <script type="text/javascript">

            var playView = demo.toggleButtonView("playButton");
			
            // Options for the scope view.
            var scopeOpts = {
                canvas: "waveform",
                styles: {
                    scaleY: 2,
                    strokeColor: "#888",
                    strokeWidth: 3
                }
            };
						
            document.getElementById("fileBrowser").addEventListener("change", function () {
                // Each time a new file is selected, reload the synth. This could be done more efficiently
                // With a call to flock.enviro.shared.loadBuffer().
                playView.synth = flock.synth({
                    id: "scope",
                    ugen: "flock.ugen.scope",

                    // Set up a playBuffer ugen,
                    // pointing it to the File object selected by the #fileBrowser input elemented.
                    // This File will automatically be loaded into a buffer named "selectedSound"
                    source: {
                        ugen: "flock.ugen.playBuffer",
                        buffer: {
                            id: "selectedSound",
                            selector: "#fileBrowser"
                        },
                        speed: 1.0
                    },

                    options: scopeOpts
                });
            });
			
            // Bind a click event to the browse button, which delegates to the hidden (ugly) file input element.
            // TODO: Chrome prevents this. :(
            document.getElementById("browse").addEventListener("click", function (e) {
                document.getElementById("fileBrowser").click();
                e.preventDefault();
            }, false);

        </script>
    </body>
</html>
